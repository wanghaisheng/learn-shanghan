<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>训练选择</title>
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
      background: linear-gradient(135deg, #1E3A8A 0%, #3B82F6 100%);
      background-attachment: fixed;
      padding-bottom: 90px;
    }
    
    .card-hover {
      transition: transform 0.3s ease, box-shadow 0.3s ease;
    }
    
    .card-hover:active {
      transform: scale(0.98);
    }
    
    .bottom-nav {
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      background-color: rgba(26, 32, 44, 0.9);
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
    }
    
    .shine {
      position: relative;
      overflow: hidden;
    }
    
    .shine::after {
      content: "";
      position: absolute;
      top: -110%;
      left: -210%;
      width: 200%;
      height: 200%;
      opacity: 0;
      transform: rotate(30deg);
      background: rgba(255, 255, 255, 0.13);
      background: linear-gradient(
        to right, 
        rgba(255, 255, 255, 0.13) 0%,
        rgba(255, 255, 255, 0.13) 77%,
        rgba(255, 255, 255, 0.5) 92%,
        rgba(255, 255, 255, 0.0) 100%
      );
      animation: shine 2s infinite;
    }
    
    @keyframes shine {
      to {
        opacity: 1;
        top: -30%;
        left: -30%;
        transition-property: left, top, opacity;
        transition-duration: 0.7s, 0.7s, 0.15s;
        transition-timing-function: ease;
      }
    }
  </style>
</head>
<body class="text-white">
  <div class="container mx-auto px-4 pt-6 pb-24">
    <div class="flex justify-between items-center mb-6">
      <h1 class="text-2xl font-bold">训练场</h1>
      <div class="flex items-center bg-black bg-opacity-30 px-3 py-1 rounded-full">
        <div class="mr-2 text-yellow-300">
          <i class="fas fa-gem"></i>
        </div>
        <span class="font-bold">500</span>
      </div>
    </div>
    
    <p class="text-blue-200 mb-6">选择一个训练副本开始你的修行之旅</p>
    
    <div class="space-y-4">
      <!-- 伤寒论副本 -->
      <div class="bg-white bg-opacity-10 rounded-xl p-4 card-hover shine" onclick="navigateTo('levels.html')">
        <div class="flex items-start">
          <div class="w-16 h-16 bg-gradient-to-br from-green-500 to-teal-600 rounded-lg flex items-center justify-center flex-shrink-0 mr-4">
            <i class="fas fa-book-medical text-2xl"></i>
          </div>
          
          <div class="flex-1">
            <div class="flex justify-between items-start">
              <h3 class="font-bold text-lg">伤寒论</h3>
              <span class="text-xs bg-green-600 rounded-full px-2 py-1">医学经典</span>
            </div>
            
            <p class="text-sm text-blue-200 mt-1 mb-3">中医经典著作，记载了汉代张仲景总结的外感热病治疗经验。</p>
            
            <div class="flex justify-between items-center text-xs">
              <span>50,000字 · <span id="shang-han-lun-days">365</span>天训练计划</span>
              <button onclick="event.stopPropagation(); showPlanSelector('伤寒论', 50000, 'shang-han-lun-days'); return false;" class="text-blue-300 hover:text-blue-200">
                <i class="fas fa-edit"></i> 修改计划
              </button>
            </div>
            
            <div class="w-full bg-gray-700 rounded-full h-2 mt-2">
              <div class="bg-green-500 h-2 rounded-full w-1/4"></div>
            </div>
          </div>
        </div>
      </div>
      
      <!-- 黄帝内经副本 -->
      <div class="bg-white bg-opacity-10 rounded-xl p-4 card-hover">
        <div class="flex items-start">
          <div class="w-16 h-16 bg-gradient-to-br from-yellow-500 to-amber-600 rounded-lg flex items-center justify-center flex-shrink-0 mr-4">
            <i class="fas fa-scroll text-2xl"></i>
          </div>
          
          <div class="flex-1">
            <div class="flex justify-between items-start">
              <h3 class="font-bold text-lg">黄帝内经</h3>
              <span class="text-xs bg-yellow-600 rounded-full px-2 py-1">医学经典</span>
            </div>
            
            <p class="text-sm text-blue-200 mt-1 mb-3">中医理论的奠基之作，阐述了人体生理、病理、诊断与治疗原则。</p>
            
            <div class="flex justify-between items-center text-xs">
              <span>80,000字 · <span id="huang-di-nei-jing-days">450</span>天训练计划</span>
              <button onclick="event.stopPropagation(); showPlanSelector('黄帝内经', 80000, 'huang-di-nei-jing-days'); return false;" class="text-blue-300 hover:text-blue-200">
                <i class="fas fa-edit"></i> 修改计划
              </button>
            </div>
            
            <div class="w-full bg-gray-700 rounded-full h-2 mt-2">
              <div class="bg-gray-500 h-2 rounded-full w-0"></div>
            </div>
          </div>
        </div>
      </div>
      
      <!-- 金匮要略副本 -->
      <div class="bg-white bg-opacity-10 rounded-xl p-4 card-hover">
        <div class="flex items-start">
          <div class="w-16 h-16 bg-gradient-to-br from-red-500 to-pink-600 rounded-lg flex items-center justify-center flex-shrink-0 mr-4">
            <i class="fas fa-heartbeat text-2xl"></i>
          </div>
          
          <div class="flex-1">
            <div class="flex justify-between items-start">
              <h3 class="font-bold text-lg">金匮要略</h3>
              <span class="text-xs bg-red-600 rounded-full px-2 py-1">医学经典</span>
            </div>
            
            <p class="text-sm text-blue-200 mt-1 mb-3">张仲景著作，主要论述内科杂病的诊断与治疗方法。</p>
            
            <div class="flex justify-between items-center text-xs">
              <span>30,000字 · <span id="jin-kui-yao-lue-days">200</span>天训练计划</span>
              <button onclick="event.stopPropagation(); showPlanSelector('金匮要略', 30000, 'jin-kui-yao-lue-days'); return false;" class="text-blue-300 hover:text-blue-200">
                <i class="fas fa-edit"></i> 修改计划
              </button>
            </div>
            
            <div class="w-full bg-gray-700 rounded-full h-2 mt-2">
              <div class="bg-gray-500 h-2 rounded-full w-0"></div>
            </div>
          </div>
        </div>
      </div>
      
      <!-- 本草纲目副本 -->
      <div class="bg-white bg-opacity-10 rounded-xl p-4 card-hover">
        <div class="flex items-start">
          <div class="w-16 h-16 bg-gradient-to-br from-purple-500 to-indigo-600 rounded-lg flex items-center justify-center flex-shrink-0 mr-4">
            <i class="fas fa-leaf text-2xl"></i>
          </div>
          
          <div class="flex-1">
            <div class="flex justify-between items-start">
              <h3 class="font-bold text-lg">本草纲目</h3>
              <span class="text-xs bg-purple-600 rounded-full px-2 py-1">医学经典</span>
            </div>
            
            <p class="text-sm text-blue-200 mt-1 mb-3">李时珍编著的药物学巨著，详细记载了近2000种药物的性能与功效。</p>
            
            <div class="flex justify-between items-center text-xs">
              <span>120,000字 · <span id="ben-cao-gang-mu-days">600</span>天训练计划</span>
              <button onclick="event.stopPropagation(); showPlanSelector('本草纲目', 120000, 'ben-cao-gang-mu-days'); return false;" class="text-blue-300 hover:text-blue-200">
                <i class="fas fa-edit"></i> 修改计划
              </button>
            </div>
            
            <div class="w-full bg-gray-700 rounded-full h-2 mt-2">
              <div class="bg-gray-500 h-2 rounded-full w-0"></div>
            </div>
          </div>
        </div>
      </div>
    </div>
    
    <!-- 底部开始新训练按钮 -->
    <div class="fixed left-0 right-0 bottom-20 px-4 mb-2">
      <button class="w-full bg-gradient-to-r from-blue-600 to-indigo-600 text-white font-bold py-4 rounded-xl shadow-lg">
        <i class="fas fa-plus-circle mr-2"></i>导入新书籍
      </button>
    </div>
  </div>
  
  <!-- 付费计划选择弹窗 -->
  <div id="planModal" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50 hidden">
    <div class="bg-gradient-to-br from-blue-800 to-indigo-900 rounded-xl p-6 w-5/6 max-w-md">
      <div class="flex justify-between items-center mb-4">
        <h3 class="text-xl font-bold" id="planModalTitle">修改学习计划</h3>
        <button onclick="closePlanModal()" class="text-white">
          <i class="fas fa-times"></i>
        </button>
      </div>
      
      <div class="mb-6">
        <p class="text-sm text-blue-200 mb-3" id="planModalInfo">设置学习期限，系统将自动为您分配每日学习内容</p>
        
        <div class="mb-4">
          <label class="block text-blue-200 text-sm mb-2">总字数</label>
          <div class="bg-white bg-opacity-20 rounded-lg p-3 text-lg" id="totalCharCount">50,000字</div>
        </div>
        
        <div class="mb-4">
          <label class="block text-blue-200 text-sm mb-2">学习期限</label>
          <select id="planDurationSelect" class="w-full bg-white bg-opacity-20 border-none rounded-lg p-3 text-white focus:ring-2 focus:ring-blue-500">
            <option value="30">30天（速成计划）</option>
            <option value="90">90天（标准计划）</option>
            <option value="180">180天（进阶计划）</option>
            <option value="365" selected>365天（全年计划）</option>
            <option value="custom">自定义天数</option>
          </select>
        </div>
        
        <div id="customDaysContainer" class="mb-4 hidden">
          <label class="block text-blue-200 text-sm mb-2">自定义天数</label>
          <input type="number" id="customDaysInput" min="7" max="999" value="365" 
                 class="w-full bg-white bg-opacity-20 border-none rounded-lg p-3 text-white focus:ring-2 focus:ring-blue-500">
        </div>
        
        <div class="mb-4">
          <label class="block text-blue-200 text-sm mb-2">每日学习量</label>
          <div class="bg-white bg-opacity-20 rounded-lg p-3" id="dailyCharCount">约137字/天</div>
        </div>
      </div>
      
      <div class="flex space-x-3">
        <button onclick="closePlanModal()" class="flex-1 bg-white bg-opacity-20 hover:bg-opacity-30 py-3 rounded-lg">
          取消
        </button>
        
        <button onclick="savePlanChanges()" class="flex-1 bg-gradient-to-r from-blue-600 to-indigo-600 py-3 rounded-lg font-bold">
          保存修改
        </button>
      </div>
      
      <div class="mt-4 text-center">
        <div class="flex items-center justify-center text-yellow-300 text-sm">
          <i class="fas fa-crown mr-2"></i>
          <span>会员专属功能</span>
        </div>
      </div>
    </div>
  </div>
  
  <!-- 底部导航 -->
  <div class="bottom-nav text-white py-2 px-4">
    <div class="flex justify-around items-center">
      <div class="text-center">
        <button onclick="navigateTo('home.html')" class="w-12 h-12 rounded-full bg-black bg-opacity-40 flex items-center justify-center mx-auto">
          <i class="fas fa-home text-xl"></i>
        </button>
        <span class="text-xs mt-1 block">主页</span>
      </div>
      
      <div class="text-center">
        <button onclick="navigateTo('training.html')" class="w-12 h-12 rounded-full bg-gradient-to-r from-blue-600 to-indigo-600 flex items-center justify-center mx-auto">
          <i class="fas fa-dumbbell text-xl"></i>
        </button>
        <span class="text-xs mt-1 block">训练</span>
      </div>
      
      <div class="text-center">
        <button onclick="navigateTo('rewards.html')" class="w-12 h-12 rounded-full bg-black bg-opacity-40 flex items-center justify-center mx-auto">
          <i class="fas fa-trophy text-xl"></i>
        </button>
        <span class="text-xs mt-1 block">成就</span>
      </div>
      
      <div class="text-center">
        <button onclick="navigateTo('statistics.html')" class="w-12 h-12 rounded-full bg-black bg-opacity-40 flex items-center justify-center mx-auto">
          <i class="fas fa-chart-line text-xl"></i>
        </button>
        <span class="text-xs mt-1 block">统计</span>
      </div>
      
      <div class="text-center">
        <button onclick="navigateTo('settings.html')" class="w-12 h-12 rounded-full bg-black bg-opacity-40 flex items-center justify-center mx-auto">
          <i class="fas fa-cog text-xl"></i>
        </button>
        <span class="text-xs mt-1 block">设置</span>
      </div>
    </div>
  </div>
  
  <script>
    // 学习计划选择相关变量
    let currentBookName = '';
    let currentCharCount = 0;
    let currentDaysElementId = '';
    
    // 显示计划选择弹窗
    function showPlanSelector(bookName, charCount, daysElementId) {
      currentBookName = bookName;
      currentCharCount = charCount;
      currentDaysElementId = daysElementId;
      
      document.getElementById('planModalTitle').textContent = `修改《${bookName}》学习计划`;
      document.getElementById('totalCharCount').textContent = `${charCount.toLocaleString()}字`;
      
      // 获取当前天数
      const currentDays = parseInt(document.getElementById(daysElementId).textContent);
      
      // 设置选择器的值
      const durationSelect = document.getElementById('planDurationSelect');
      if ([30, 90, 180, 365].includes(currentDays)) {
        durationSelect.value = currentDays.toString();
        document.getElementById('customDaysContainer').classList.add('hidden');
      } else {
        durationSelect.value = 'custom';
        document.getElementById('customDaysInput').value = currentDays;
        document.getElementById('customDaysContainer').classList.remove('hidden');
      }
      
      // 计算并显示每日学习量
      updateDailyCharCount();
      
      // 显示弹窗
      document.getElementById('planModal').classList.remove('hidden');
    }
    
    // 关闭计划选择弹窗
    function closePlanModal() {
      document.getElementById('planModal').classList.add('hidden');
    }
    
    // 更新每日学习量显示
    function updateDailyCharCount() {
      const durationSelect = document.getElementById('planDurationSelect');
      let days;
      
      if (durationSelect.value === 'custom') {
        days = parseInt(document.getElementById('customDaysInput').value);
      } else {
        days = parseInt(durationSelect.value);
      }
      
      // 确保天数有效
      if (!days || days < 1) days = 365;
      
      // 计算每日字数
      const dailyChar = Math.ceil(currentCharCount / days);
      document.getElementById('dailyCharCount').textContent = `约${dailyChar}字/天`;
    }
    
    // 保存计划更改
    function savePlanChanges() {
      const durationSelect = document.getElementById('planDurationSelect');
      let days;
      
      if (durationSelect.value === 'custom') {
        days = parseInt(document.getElementById('customDaysInput').value);
        if (!days || days < 7) days = 7;
        if (days > 999) days = 999;
      } else {
        days = parseInt(durationSelect.value);
      }
      
      // 更新页面上的天数显示
      document.getElementById(currentDaysElementId).textContent = days;
      
      // 关闭弹窗
      closePlanModal();
      
      // 显示确认消息
      alert(`《${currentBookName}》学习计划已更新为${days}天。系统已自动为您重新分配每日学习内容。`);
    }
    
    // 监听选择器变化
    document.getElementById('planDurationSelect').addEventListener('change', function() {
      if (this.value === 'custom') {
        document.getElementById('customDaysContainer').classList.remove('hidden');
      } else {
        document.getElementById('customDaysContainer').classList.add('hidden');
      }
      updateDailyCharCount();
    });
    
    // 监听自定义天数输入变化
    document.getElementById('customDaysInput').addEventListener('input', updateDailyCharCount);
    
    function navigateTo(route) {
      if (window.parent && window.parent.postMessage) {
        window.parent.postMessage({ route: route }, '*');
      } else {
        window.location.href = route;
      }
    }
  </script>
</body>
</html>